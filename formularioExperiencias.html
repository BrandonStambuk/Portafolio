<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
    <link rel="stylesheet" href="formulario/styles.css">
    <link rel="stylesheet" href="estilo.css">
    <link rel="stylesheet" href="subirImagen/style.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>
<body>
    <div class="contenedor-header">
        <header>
            <div class="logo">
                <a href="#">USUARIO</a>
            </div>
            <nav id="menu">
                <ul>
                    <li><a href="/index.html" ">INICIO</a></li>
                   
                    <li><a href="/index.html" onclick="seleccionar()">PROYECTOS</a></li>
                    <li><a href="/index.html#experiencias" onclick="seleccionar()">EXPERIENCIAS</a></li>
                    <li><a href="#curriculum" onclick="seleccionar()">CURRICULUM</a></li>
                    <li><a href="#curriculum" onclick="seleccionar()">COMENTARIOS</a></li>
                 <!--    <li><a href="#skills" onclick="seleccionar()">SKILLS</a></li>-->
                    <li><a href="/index.html#redes" onclick="seleccionar()">REDES</a></li>
                </ul>
            </nav>
            <div class="nav-responsive" onclick="mostrarOcultarMenu()">
                <i class="fa-solid fa-bars"></i>
            </div>
        </header>
    </div>
    <main>        
        <div class="container">
            <h1 id="titulo">NUEVA EXPERIENCIA</h1>
            <div id="ingreso">
                <div class="contenedordatos">
                    <label for="nombre">TITULO:</label>
                    <input id="inputxt" type="text" id="nombre" name="nombre" placeholder="Título">
                </div>
                <div class="contenedordatos">
                    <label for="nombre">DESCRIPCION:</label>
                    <textarea id="descripcion"  name="descripcion" placeholder="Comentario"></textarea>
                </div>
                <div class="contenedordatos">
                    <label for="inicioMes">FECHA DE INICIO:</label>
                    <select id="inicioMes" name="inicioMes">
                        <option value="">Mes</option>
                        <option value="enero">Enero</option>
                        <option value="febrero">Febrero</option>
                        <option value="marzo">Marzo</option>
                        <option value="abril">Abril</option>
                        <option value="mayo">Mayo</option>
                        <option value="junio">Junio</option>
                        <option value="julio">Julio</option>
                        <option value="agosto">Agosto</option>
                        <option value="septiembre">Septiembre</option>
                        <option value="octubre">Octubre</option>
                        <option value="noviembre">Noviembre</option>
                        <option value="diciembre">Diciembre</option>
                    </select>
                    <select id="inicioAnio" name="inicioAnio">
                        <option value="">Año</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                        <option value="2019">2019</option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                        <option value="2015">2015</option>
                        <option value="2014">2014</option>
                        <option value="2013">2013</option>
                    </select>
                </div>
                <div class="contenedordatos">
                    <label for="finMes">FECHA DE FIN:</label>
                    <select id="finMes" name="finMes">
                        <option value="">Mes</option>
                        <option value="enero">Enero</option>
                        <option value="febrero">Febrero</option>
                        <option value="marzo">Marzo</option>
                        <option value="abril">Abril</option>
                        <option value="mayo">Mayo</option>
                        <option value="junio">Junio</option>
                        <option value="julio">Julio</option>
                        <option value="agosto">Agosto</option>
                        <option value="septiembre">Septiembre</option>
                        <option value="octubre">Octubre</option>
                        <option value="noviembre">Noviembre</option>
                        <option value="diciembre">Diciembre</option>
                    </select>
                    <select id="finAnio" name="finAnio">
                        <option value="">Año</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                        <option value="2019">2019</option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                        <option value="2015">2015</option>
                        <option value="2014">2014</option>
                        <option value="2013">2013</option>
                    </select>
                </div>
                <div class="contenedordatos">
                    <label for="nombre">CATEGORIA:</label>
                    <select id="categoria" name="categoria">
                        <option value="">Selecciona una categoría</option>
                        <option value="laboral">Laboral</option>
                        <option value="academico">Académico</option>
                        <option value="extracurricular">Extracurricular</option>
                    </select>
                </div>
                <div class="contenedorfile">
                    <label for="archivo">IMAGEN:</label>
                    <label for="archivo" onclick="showLoginDialog()">
                        <img id="camaraIcon" src="formulario/imagen.png" alt="Click aquí para subir tu foto" title="Click aquí para subir tu foto">
                    </label>
                </div>                
                <dialog id="login-dialog">
                    <div class="container">
                        <form class="file-form" id="dropSection">
                            <input id="fileInput" type="file" multiple accept="image/*" onchange="app.actions.handleFiles(this.files)">
                            <label class="drop-content" for="fileInput">
                                Arrastra tus imágenes aquí o haz click y selecciona
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" fill="none" viewBox="0 0 24 20" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                            </label>
                        </form>
                        <div id="uploadedImage"></div>
                        <div id="actionContainer" class="d-none">
                            <div>
                                <button id="clearAllBtn" onclick="app.actions.clearAll()">Limpiar</button>
                            </div>
                            <div>
                                <button id="agregarBtn" onclick="app.actions.agregar()">Agregar</button>
                            </div>
                            <div>
                                <button id="cancelBtn" onclick="app.actions.cancel()">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </dialog>
                <div class="submit-container">
                    <input id="boton" type="submit" value="Enviar">
                </div>
            </div>
        </div>
    </main>
    <script src="subirImagen/main.js"></script>
    <script src="formulario/esferas.js"></script>
    <script>
        const dialog = document.getElementById('login-dialog');

        function showLoginDialog() {
            dialog.showModal();
        }

        document.getElementById('boton').addEventListener('click', function(event) {
    event.preventDefault(); // Evitar el envío del formulario
    validarFormulario();
});

function validarFormulario() {
    const titulo = document.getElementById('inputxt').value;
    const descripcion = document.getElementById('descripcion').value;
    const inicioMes = document.getElementById('inicioMes').value;
    const inicioAnio = document.getElementById('inicioAnio').value;
    const finMes = document.getElementById('finMes').value;
    const finAnio = document.getElementById('finAnio').value;
    const categoria = document.getElementById('categoria').value;
    const images = document.getElementById('fileInput').files;

    // Validar que los campos no estén vacíos
    if (!titulo || !descripcion || !inicioMes || !inicioAnio || !finMes || !finAnio || !categoria || images.length === 0) {
        mostrarModal('Por favor, completa todos los campos.');
        return;
    }
    if (finAnio < inicioAnio) {
        mostrarModal('La fecha de fin no puede ser anterior a la fecha de inicio.');
        return;
    }
    // Si todo está bien, guardar los datos en el Local Storage y mostrar el modal de éxito
    saveFormData();
    mostrarModal('Experiencia añadida satisfactoriamente.');
}

function saveFormData() {
    const titulo = document.getElementById('inputxt').value;
    const descripcion = document.getElementById('descripcion').value;
    const inicioMes = document.getElementById('inicioMes').value;
    const inicioAnio = document.getElementById('inicioAnio').value;
    const finMes = document.getElementById('finMes').value;
    const finAnio = document.getElementById('finAnio').value;
    const categoria = document.getElementById('categoria').value;
    const images = document.getElementById('fileInput').files;

    const imagePromises = Array.from(images).map(file => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });
    });

    Promise.all(imagePromises).then(base64Images => {
        const formData = {
            titulo,
            descripcion,
            inicioMes,
            inicioAnio,
            finMes,
            finAnio,
            categoria,
            images: base64Images
        };

        localStorage.setItem('formData', JSON.stringify(formData));
    }).catch(error => {
        console.error('Error al convertir las imágenes a base64:', error);
        alert('Error al guardar las imágenes.');
    });
}

function mostrarModal(mensaje) {
    const modal = document.getElementById('myModal');
    const modalMessage = document.getElementById('modal-message');
    const span = document.getElementsByClassName('close')[0];

    modalMessage.textContent = mensaje;
    modal.style.display = 'block';

    // Cuando el usuario haga clic en (x) o fuera del modal
    span.onclick = function() {
        modal.style.display = 'none';
        // Redirigir solo si el mensaje es "Experiencia añadida satisfactoriamente."
        if (mensaje === 'Experiencia añadida satisfactoriamente.') {
            window.location.href = 'index.html'; // Redirigir a index.html
        }
    }

    // Cuando el usuario haga clic en cualquier parte fuera del modal, también cerrarlo
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
            // Redirigir solo si el mensaje es "Experiencia añadida satisfactoriamente."
            if (mensaje === 'Experiencia añadida satisfactoriamente.') {
                window.location.href = 'index.html'; // Redirigir a index.html
            }
        }
    }
}
    </script>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-icon"></div>
        <p id="modal-message"> Experiencia añadida</p>
    </div>
</div>
</body>
</html>
